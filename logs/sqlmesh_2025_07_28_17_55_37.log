2025-07-28 17:55:38,306 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Compacting 7 intervals for 7 snapshots (interval.py:129)
2025-07-28 17:55:38,306 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."enrich"."account": 2372665894> (interval.py:214)
2025-07-28 17:55:38,307 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."enrich"."product": 3294743817> (interval.py:214)
2025-07-28 17:55:38,307 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."enrich"."transactions": 2474979436> (interval.py:214)
2025-07-28 17:55:38,307 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."raw"."account": 3363262171> (interval.py:214)
2025-07-28 17:55:38,307 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."raw"."customer": 2916775664> (interval.py:214)
2025-07-28 17:55:38,307 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."raw"."product": 1420995480> (interval.py:214)
2025-07-28 17:55:38,307 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."raw"."transactions": 365872381> (interval.py:214)
2025-07-28 17:55:38,326 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Compacting 0 intervals for 0 snapshots (interval.py:129)
2025-07-28 17:55:38,492 - ThreadPoolExecutor-1_0 - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"postgres"."enrich"."account": 2372665894> (evaluator.py:637)
2025-07-28 17:55:38,499 - ThreadPoolExecutor-1_2 - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"postgres"."enrich"."transactions": 2474979436> (evaluator.py:637)
2025-07-28 17:55:38,499 - ThreadPoolExecutor-1_1 - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"postgres"."enrich"."product": 3294743817> (evaluator.py:637)
2025-07-28 17:55:38,523 - ThreadPoolExecutor-1_0 - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-28 12:10:00, 2025-07-28 12:25:00) into postgres.sqlmesh__enrich.enrich__account__2754391612' (evaluator.py:691)
2025-07-28 17:55:38,526 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT 1 FROM "information_schema"."tables" WHERE "table_name" = 'enrich__account__2754391612' AND "table_schema" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,554 - ThreadPoolExecutor-1_2 - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-28 12:10:00, 2025-07-28 12:25:00) into postgres.sqlmesh__enrich.enrich__transactions__711840502' (evaluator.py:691)
2025-07-28 17:55:38,556 - ThreadPoolExecutor-1_2 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT 1 FROM "information_schema"."tables" WHERE "table_name" = 'enrich__transactions__711840502' AND "table_schema" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,575 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DELETE FROM "sqlmesh__enrich"."enrich__account__2754391612" WHERE TRUE (base.py:2184)
2025-07-28 17:55:38,583 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO "sqlmesh__enrich"."enrich__account__2754391612" ("account_id", "account_number", "product_id", "opening_date", "current_balance", "avg_monthly_balance", "avg_qtr_balance", "cust_id", "available_balance", "credit_card", "debit_card", "currency_code", "account_status", "source_channel", "campaign_id", "applied_interest_rate", "statement_date", "mode_of_statement") SELECT "account"."account_id" AS "account_id", "account"."account_number" AS "account_number", "account"."product_id" AS "product_id", "account"."account_origination_date" AS "opening_date", "account"."current_balance" AS "current_balance", "account"."avg_monthly_balance" AS "avg_monthly_balance", "account"."avg_qtr_balance" AS "avg_qtr_balance", "account"."primary_account_holder_id" AS "cust_id", "account"."available_balance" AS "available_balance", "account"."credit_card" AS "credit_card", "account"."debit_card" AS "debit_card", "account"."currency_code" AS "currency_code", "account"."account_status" AS "account_status", "account"."source_channel" AS "source_channel", "account"."campaign_id" AS "campaign_id", "account"."applied_interest_rate" AS "applied_interest_rate", "account"."statement_date" AS "statement_date", "account"."mode_of_statement" AS "mode_of_statement" FROM "postgres"."sqlmesh__raw"."raw__account__3286186908" AS "account" (base.py:2184)
2025-07-28 17:55:38,588 - ThreadPoolExecutor-1_2 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DELETE FROM "sqlmesh__enrich"."enrich__transactions__711840502" WHERE TRUE (base.py:2184)
2025-07-28 17:55:38,591 - ThreadPoolExecutor-1_1 - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-07-28 12:10:00, 2025-07-28 12:25:00) into postgres.sqlmesh__enrich.enrich__product__332702689' (evaluator.py:691)
2025-07-28 17:55:38,593 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT 1 FROM "information_schema"."tables" WHERE "table_name" = 'enrich__product__332702689' AND "table_schema" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,596 - ThreadPoolExecutor-1_2 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO "sqlmesh__enrich"."enrich__transactions__711840502" ("Unnamed: 0", "cust_id", "account_id", "card_id", "transaction_id", "transaction_amnt", "mode_of_payment", "mcc_code", "transaction_time_stamp", "transaction_sign", "transaction_type", "swift_cd", "currency_cd", "transaction_status", "product_id", "channel_id", "count", "posting_date", "value_date", "notes", "reason_code", "created_at") SELECT "transactions"."Unnamed: 0" AS "Unnamed: 0", "transactions"."cust_id" AS "cust_id", "transactions"."account_id" AS "account_id", "transactions"."card_id" AS "card_id", "transactions"."transaction_id" AS "transaction_id", "transactions"."transaction_amnt" AS "transaction_amnt", "transactions"."mode_of_payment" AS "mode_of_payment", "transactions"."mcc_code" AS "mcc_code", "transactions"."transaction_time_stamp" AS "transaction_time_stamp", "transactions"."transaction_sign" AS "transaction_sign", "transactions"."transaction_type" AS "transaction_type", "transactions"."swift_cd" AS "swift_cd", "transactions"."currency_cd" AS "currency_cd", "transactions"."transaction_status" AS "transaction_status", "transactions"."product_id" AS "product_id", "transactions"."channel_id" AS "channel_id", "transactions"."count" AS "count", "transactions"."posting_date" AS "posting_date", "transactions"."value_date" AS "value_date", "transactions"."notes" AS "notes", "transactions"."reason_code" AS "reason_code", "transactions"."created_at" AS "created_at" FROM "postgres"."sqlmesh__raw"."raw__transactions__1169070496" AS "transactions" (base.py:2184)
2025-07-28 17:55:38,599 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: DELETE FROM "sqlmesh__enrich"."enrich__product__332702689" WHERE TRUE (base.py:2184)
2025-07-28 17:55:38,602 - ThreadPoolExecutor-1_0 - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"postgres"."enrich"."account": 2372665894> (evaluator.py:543)
2025-07-28 17:55:38,605 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "attname" AS "column_name", "pg_catalog".format_type("atttypid", "atttypmod") AS "data_type" FROM "pg_catalog"."pg_attribute" JOIN "pg_catalog"."pg_class" ON "pg_class"."oid" = "attrelid" JOIN "pg_catalog"."pg_namespace" ON "pg_namespace"."oid" = "relnamespace" WHERE ("attnum" > 0 AND NOT "attisdropped" AND "relname" = 'enrich__account__2754391612') AND "nspname" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,610 - ThreadPoolExecutor-1_2 - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"postgres"."enrich"."transactions": 2474979436> (evaluator.py:543)
2025-07-28 17:55:38,610 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: INSERT INTO "sqlmesh__enrich"."enrich__product__332702689" ("type", "name", "currency_code", "status", "credit_interest_rate", "debit_interest_rate", "credit_line_amount", "created_at", "modified_at", "product_id", "total_account", "total_customer", "total_active_account", "total_dormant_account", "total_balance") WITH "product_cte" AS (SELECT "product"."key" AS "type", "product"."name" AS "name", "product"."currency_code" AS "currency_code", "product"."status" AS "status", "product"."credit_interest_rate" AS "credit_interest_rate", "product"."debit_interest_rate" AS "debit_interest_rate", "product"."credit_line_amount" AS "credit_line_amount", "product"."created_at" AS "created_at", "product"."modified_at" AS "modified_at", "product"."id" AS "product_id" FROM "postgres"."sqlmesh__raw"."raw__product__3418704722" AS "product"), "total_account_per_product" AS (SELECT "account"."product_id" AS "product_id", COUNT(DISTINCT "account"."account_id") AS "total_account", COUNT("account"."primary_account_holder_id") AS "total_customer", COUNT("account"."account_id") FILTER(WHERE "account"."account_status" = 'Active') AS "total_active_account", COUNT("account"."account_id") FILTER(WHERE "account"."account_status" = 'Dormant') AS "total_dormant_account" FROM "postgres"."sqlmesh__raw"."raw__account__3286186908" AS "account" GROUP BY "account"."product_id" ORDER BY "product_id"), "current_holding_ammount" AS (SELECT "account"."product_id" AS "product_id", SUM("account"."current_balance") AS "total_balance" FROM "postgres"."sqlmesh__raw"."raw__account__3286186908" AS "account" GROUP BY "account"."product_id" ORDER BY "product_id") SELECT "pp"."type" AS "type", "pp"."name" AS "name", "pp"."currency_code" AS "currency_code", "pp"."status" AS "status", "pp"."credit_interest_rate" AS "credit_interest_rate", "pp"."debit_interest_rate" AS "debit_interest_rate", "pp"."credit_line_amount" AS "credit_line_amount", "pp"."created_at" AS "created_at", "pp"."modified_at" AS "modified_at", "pp"."product_id" AS "product_id", "tp"."total_account" AS "total_account", "tp"."total_customer" AS "total_customer", "tp"."total_active_account" AS "total_active_account", "tp"."total_dormant_account" AS "total_dormant_account", "ch"."total_balance" AS "total_balance" FROM "product_cte" AS "pp" LEFT JOIN "total_account_per_product" AS "tp" ON "pp"."product_id" = "tp"."product_id" LEFT JOIN "current_holding_ammount" AS "ch" ON "ch"."product_id" = "pp"."product_id" (base.py:2184)
2025-07-28 17:55:38,615 - ThreadPoolExecutor-1_2 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "attname" AS "column_name", "pg_catalog".format_type("atttypid", "atttypmod") AS "data_type" FROM "pg_catalog"."pg_attribute" JOIN "pg_catalog"."pg_class" ON "pg_class"."oid" = "attrelid" JOIN "pg_catalog"."pg_namespace" ON "pg_namespace"."oid" = "relnamespace" WHERE ("attnum" > 0 AND NOT "attisdropped" AND "relname" = 'enrich__transactions__711840502') AND "nspname" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,628 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM "postgres"."sqlmesh__raw"."raw__account__3286186908" AS "account" WHERE NOT "account_status" IN ('Active', 'Dormant')) AS "audit" (base.py:2184)
2025-07-28 17:55:38,635 - ThreadPoolExecutor-1_1 - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"postgres"."enrich"."product": 3294743817> (evaluator.py:543)
2025-07-28 17:55:38,640 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "attname" AS "column_name", "pg_catalog".format_type("atttypid", "atttypmod") AS "data_type" FROM "pg_catalog"."pg_attribute" JOIN "pg_catalog"."pg_class" ON "pg_class"."oid" = "attrelid" JOIN "pg_catalog"."pg_namespace" ON "pg_namespace"."oid" = "relnamespace" WHERE ("attnum" > 0 AND NOT "attisdropped" AND "relname" = 'enrich__product__332702689') AND "nspname" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,647 - ThreadPoolExecutor-1_2 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM (SELECT ROW_NUMBER() OVER (PARTITION BY ("transaction_id") ORDER BY ("transaction_id") NULLS FIRST) AS "rank_" FROM "postgres"."sqlmesh__enrich"."enrich__transactions__711840502" AS "enrich__transactions__711840502" WHERE TRUE) AS "_q_0" WHERE "rank_" > 1) AS "audit" (base.py:2184)
2025-07-28 17:55:38,655 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "attname" AS "column_name", "pg_catalog".format_type("atttypid", "atttypmod") AS "data_type" FROM "pg_catalog"."pg_attribute" JOIN "pg_catalog"."pg_class" ON "pg_class"."oid" = "attrelid" JOIN "pg_catalog"."pg_namespace" ON "pg_namespace"."oid" = "relnamespace" WHERE ("attnum" > 0 AND NOT "attisdropped" AND "relname" = 'enrich__account__2754391612') AND "nspname" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,668 - ThreadPoolExecutor-1_0 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM (SELECT ROW_NUMBER() OVER (PARTITION BY ("account_id") ORDER BY ("account_id") NULLS FIRST) AS "rank_" FROM "postgres"."sqlmesh__enrich"."enrich__account__2754391612" AS "enrich__account__2754391612" WHERE TRUE) AS "_q_0" WHERE "rank_" > 1) AS "audit" (base.py:2184)
2025-07-28 17:55:38,681 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM (SELECT ROW_NUMBER() OVER (PARTITION BY ("product_id") ORDER BY ("product_id") NULLS FIRST) AS "rank_" FROM "postgres"."sqlmesh__enrich"."enrich__product__332702689" AS "enrich__product__332702689" WHERE TRUE) AS "_q_0" WHERE "rank_" > 1) AS "audit" (base.py:2184)
2025-07-28 17:55:38,681 - ThreadPoolExecutor-1_2 - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-28 12:10:00, 2025-07-28 12:25:00) for snapshot SnapshotId<"postgres"."enrich"."transactions": 2474979436> (facade.py:625)
2025-07-28 17:55:38,681 - ThreadPoolExecutor-1_2 - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."enrich"."transactions": 2474979436> (interval.py:214)
2025-07-28 17:55:38,690 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "attname" AS "column_name", "pg_catalog".format_type("atttypid", "atttypmod") AS "data_type" FROM "pg_catalog"."pg_attribute" JOIN "pg_catalog"."pg_class" ON "pg_class"."oid" = "attrelid" JOIN "pg_catalog"."pg_namespace" ON "pg_namespace"."oid" = "relnamespace" WHERE ("attnum" > 0 AND NOT "attisdropped" AND "relname" = 'enrich__product__332702689') AND "nspname" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,691 - ThreadPoolExecutor-1_0 - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-28 12:10:00, 2025-07-28 12:25:00) for snapshot SnapshotId<"postgres"."enrich"."account": 2372665894> (facade.py:625)
2025-07-28 17:55:38,696 - ThreadPoolExecutor-1_0 - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."enrich"."account": 2372665894> (interval.py:214)
2025-07-28 17:55:38,703 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM "postgres"."sqlmesh__raw"."raw__account__3286186908" AS "account" WHERE NOT "account_status" IN ('Active', 'Dormant')) AS "audit" (base.py:2184)
2025-07-28 17:55:38,718 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT "attname" AS "column_name", "pg_catalog".format_type("atttypid", "atttypmod") AS "data_type" FROM "pg_catalog"."pg_attribute" JOIN "pg_catalog"."pg_class" ON "pg_class"."oid" = "attrelid" JOIN "pg_catalog"."pg_namespace" ON "pg_namespace"."oid" = "relnamespace" WHERE ("attnum" > 0 AND NOT "attisdropped" AND "relname" = 'enrich__product__332702689') AND "nspname" = 'sqlmesh__enrich' (base.py:2184)
2025-07-28 17:55:38,736 - ThreadPoolExecutor-1_1 - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: SELECT COUNT(*) FROM (SELECT * FROM "postgres"."sqlmesh__enrich"."enrich__product__332702689" AS "enrich__product__332702689" WHERE "product_id" IS NULL) AS "audit" (base.py:2184)
2025-07-28 17:55:38,742 - ThreadPoolExecutor-1_1 - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-07-28 12:10:00, 2025-07-28 12:25:00) for snapshot SnapshotId<"postgres"."enrich"."product": 3294743817> (facade.py:625)
2025-07-28 17:55:38,743 - ThreadPoolExecutor-1_1 - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"postgres"."enrich"."product": 3294743817> (interval.py:214)
2025-07-28 17:55:38,769 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
